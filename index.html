<HTML>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<head>
		<title>
			Calculadora de Matrizes
		</title>
	</head>
	<body>
		<center>
			<table style = "vertical-align:center; height:100%">
				<tr>
					<td>
						<center>
							<a style="text-align:center;font-size:40px;">Calculadora de Matrizes</a>
							<div id = "err" style = "font-color:#F00; text-align:center;"></div><br>
							<table class="outer">
								<tr class="outer">
									<th class="outer" style = "vertical-align:center;">
										<a style="color:#F00; font-size:22px;">Matriz 1</a><br>
										<a style="color:#000; font-size:12px;" id = "m1_info">Tem inversa: ? | É simétrica: ?</a>
									</th>
									<th class="outer" style = "vertical-align:center;">
										<a style="color:#00F; font-size:22px;">Matriz 2</a><br>
										<a style="color:#000; font-size:12px;" id = "m2_info">Tem inversa: ? | É simétrica: ?</a>
									</th>
									<th class="outer" style = "vertical-align:center;">
										<a style="color:#0A0; font-size:22px;">Matriz Resultado</a><br>
										<a style="color:#000; font-size:12px;" id = "m3_info">Tem inversa: ? | É simétrica: ?</a>
									</th>
								</tr>
								<tr class="outer"  style = "display : none">
									<td>
										<center>
											<table id = "tabela_matriz_1" style = "display:none;"></table>
										</center>
									</td>
									<td>
										<center>
											<table id = "tabela_matriz_2" style = "display:none;"></table>
										</center>
									</td>
									<td>
										<center>
											<table id = "tabela_matriz_3" style = "display:none;"></table>
										</center>
									</td>
								</tr>
								<tr class="outer">
									<td class = "outer" style = "vertical-align:bottom">
										<center>
											<div style = "margin:5 5 5 5">
												<input id="linha_amount_1" placeholder = "# de linhas" style = "width:90;">
												<input id="coluna_amount_1" placeholder = "# de colunas" style = "width:90;">
												<button onclick = "alterTable('1');">Alterar</button>
											</div>
										</center>
									</td>
									<td class = "outer" style = "vertical-align:bottom">
										<center>
											<div style = "margin:5 5 5 5">
												<input id="linha_amount_2" placeholder = "# de linhas" style = "width:90;">
												<input id="coluna_amount_2" placeholder = "# de colunas" style = "width:90;">
												<button onclick = "document.getElementById('linha_amount_1').value = 2; document.getElementById('coluna_amount_1').value = 2;alterTable('1');alterTable('2');">Alterar</button>
											</div>
										</center>
									</td>
									<td class = "outer" style = "background-color : #333">
										<center>
											<canvas id="display" style = "background-color : #333;">
											</canvas>
										</center>
									</td>
								</tr>
							</table>
						</center>
						
						<br>
						<div>
							<button onclick = "sum();">Somar</button> <!-- Chama a função -->
							<button onclick = "sub();">Subtrair</button> <!-- Chama a função -->
							<button onclick = "if(m1.width==1 && m1.height == 1){multE();}else{mult();}">Multiplicar</button> <!-- Chama a função -->
							<table style = "display:inline">
								<tr>
									<td>
										<center>
											<select id="transposta_id">
											  <option value="1">Matriz 1</option>
											  <option value="2">Matriz 2</option>
											</select>
										</center>
									</td>
								</tr>
								<tr>
									<td>
										<center>
											<button onclick = "transp()">Transposta</button> <!-- Chama a função -->
										</center>
									</td>
								</tr>
							</table>
							<table style = "display:inline">
								<tr>
									<td>
										<center>
											<select id="det_id">
											  <option value="1">Matriz 1</option>
											  <option value="2">Matriz 2</option>
											</select>
										</center>
									</td>
								</tr>
								<tr>
									<td>
										<center>
											<button onclick = "det()">Determinante</button> <!-- Chama a função -->
										</center>
									</td>
								</tr>
							</table>
							<table style = "display:inline">
								<tr>
									<td>
										<center>
											<select id="inversa_id">
											  <option value="1">Matriz 1</option>
											  <option value="2">Matriz 2</option>
											</select>
										</center>
									</td>
								</tr>
								<tr>
									<td>
										<center>
											<button onclick = "inversa()">Inversa</button> <!-- Chama a função -->
										</center>
									</td>
								</tr>
							</table>
							<table style = "display:inline;">
								<tr>
									<td>
										<center>
											<a style = "font-size:22px">Lei de formação: </a>
										</center>
									</td>
								</tr><tr>
									<td>
										<center>
											<a>Destino: </a>		
											<select id="lei_de_formacao_id">
											  <option value="1">Matriz 1</option>
											  <option value="2">Matriz 2</option>
											</select>
										</center>
									</td>
								</tr><tr>
									<td>
										<input id = "lei_de_formacao_width" placeholder = "# de linhas" style = "width:84;"></input>
										<input id = "lei_de_formacao_height" placeholder = "# de colunas" style = "width:85;"></input>
									</td>
								</tr><tr>
									<td>
										<input id = "lei_de_formacao_code" placeholder = "Digite aqui a lei de formação"></input>
									</td>
								</tr><tr>
									<td>
										<center>
											<button onclick = "gerarLeiDeFormacao()">Gerar</button>
										</center>
									</td>
								</tr>
							</table>
							<table style = "display:inline;">
								<tr>
									<td>
										<center>
											<a style = "font-size:22px">Transformações lineares</a>
										</center>
									</td>
								</tr><tr>
									<td>
										<div id = "destino_id">								
											<center>
												<a>Destino: </a>		
												<select id="transformacao_destino">
												  <option value="1">Matriz 1</option>
												  <option value="2">Matriz 2</option>
												</select>
											</center>
										</div>
									</td>
								</tr><tr>
									<td>
										<center>
											<a>Transformação: </a>		
											<select id="transformacao_id" onchange = "transformacaoChanged()">
											  <option value="1">Translação</option>
											  <option value="2">Rotação</option>
											  <option value="3">Escala</option>
											</select>
										</center>
									</td>
								</tr><tr>
									<td>
										<div id = "translacao_div">
											<input id = "translacao_x" placeholder = "X" style = "width:106;"></input>
											<input id = "translacao_y" placeholder = "Y" style = "width:106;"></input>
										</div>
										<div id = "rotacao_div" style = "display:none">
											<center>
												<input id = "rotacao_angle" placeholder = "Angle" style = "width:216;"></input>
											</center>
										</div>
										<div id = "escala_div" style = "display:none">
											<input id = "escala_val" placeholder = "Fator de escala" style = "width:216;"></input>
										</div>
									</td>
								</tr><tr>
									<td>
										<center>
											<button onclick = "aplicarTransformacao()">Aplicar</button>
										</center>
									</td>
								</tr>
							</table>
							<br>
							<div style="width:100%;text-align:right;padding-top:15px">
								<a style = "font-size:10px">Patrick Pissurno, Breno Ferreira</a>
							</div>
						</div>
					</td>
				</tr>
			</table>
		</center>
	</body>
</html>

<style>
.outer,table{
	border : none;
	padding : 0 0 0 0;
	margin : 0 0 0 0;
	background-color : #FFF;
}
table.outer
{
	background-color : #000;
}
</style>

<script>
var matrix_size = function(width,height)
{
	this.width = width;	//linhas
	this.height = height; //colunas
}

var Point = function(x,y){this.x = x; this.y = y}; //Point é um objeto que cotem um par de X e Y.

//Define as variáveis que representam o tamanho das 3 matrizes
var m1 = new matrix_size(0,0);	//Matriz 1
var m2 = new matrix_size(0,0);	//Matriz 2
var m3 = new matrix_size(0,0);	//Matriz Resultado

var canvas = document.getElementById("display");
var ctx = canvas.getContext("2d");

function transformacaoChanged()
{
	var a = document.getElementById("transformacao_id").value;
	if(a == "2")
		document.getElementById("destino_id").value = "2";
	document.getElementById("translacao_div").style.display = a == "1" ? "" : "none";
	document.getElementById("destino_id").style.display = a == "1" ? "" : "none";
	document.getElementById("rotacao_div").style.display = a == "2" ? "" : "none";
	document.getElementById("escala_div").style.display = a == "3" ? "" : "none";
}

function aplicarTransformacao()
{
	var t = document.getElementById("transformacao_id").value;
	var id = document.getElementById("transformacao_destino").value;
	var m = id == "1" ? m1 : m2;
	var m_t = id == "1" ? "2" : "1";
	switch(t)
	{
		case "1":
			//Translação
			replaceNulls(id);
			document.getElementById("linha_amount_" + m_t).value = m.width;
			document.getElementById("coluna_amount_" + m_t).value = m.height;
			alterTable(m_t);
			//changeTableSize(m_t, m);
			for(var j=0; j<m.height; j++)	//j=0; j<colunas; j++
			{
				//Formatação dos IDs: t_IDdaMatriz_linha_coluna. Exemplo: t_1_1_2 (matriz 1, linha 1, coluna 2)
				var _mx = document.getElementById("t_" + id + "_" + 0 + "_" + j);
				var _my = document.getElementById("t_" + id + "_" + 1 + "_" + j);
				var _tx = document.getElementById("t_" + m_t + "_" + 0 + "_" + j);
				var _ty = document.getElementById("t_" + m_t + "_" + 1 + "_" + j);
				//Você pode acessar o valor e definir através da propriedade value. Atenção: o tipo é string, logo precisa usar parseInt para converter pra int
				//antes de realizar operações
				_tx.value = parseFloat(document.getElementById("translacao_x").value);
				_ty.value = parseFloat(document.getElementById("translacao_y").value);
			}
			UpdateDrawInfo();
			sum();
			break;
		case "2":
			//Rotação
			
			m_t = "2";
			id = "1";
			var m = id == "1" ? m1 : m2;
			
			replaceNulls(id);
			document.getElementById("linha_amount_" + id).value = 2;
			document.getElementById("coluna_amount_" + id).value = 2;
			alterTable(id);
			
			var rotA = parseFloat(document.getElementById("rotacao_angle").value);
			//changeTableSize(m_t, m);
			
			var _00 = document.getElementById("t_" + id + "_" + 0 + "_" + 0);
			var _01 = document.getElementById("t_" + id + "_" + 0 + "_" + 1);
			var _10 = document.getElementById("t_" + id + "_" + 1 + "_" + 0);
			var _11 = document.getElementById("t_" + id + "_" + 1 + "_" + 1);
			
			_00.value = Math.cos(degToRag(rotA));
			_01.value = -Math.sin(degToRag(rotA));
			_10.value = Math.sin(degToRag(rotA));
			_11.value = Math.cos(degToRag(rotA));
			
			UpdateDrawInfo();
			mult();
			break;
		case "3":
			//Escala
			
			m_t = "2";
			id = "1";
			var m = id == "1" ? m1 : m2;
			
			replaceNulls(id);
			document.getElementById("linha_amount_" + id).value = 1;
			document.getElementById("coluna_amount_" + id).value = 1;
			alterTable(id);
			
			var valA = parseFloat(document.getElementById("escala_val").value);
			var _00 = document.getElementById("t_" + id + "_" + 0 + "_" + 0);
			_00.value = valA;
			
			UpdateDrawInfo();
			multE();
			
			break;
	}
}

function degToRag(d)
{
	return d * (Math.PI/180);
}

function sum()
{
	var t1 = document.getElementById("tabela_matriz_1");	//Pega o elemento do HTML que representa a matriz 1
	var t2 = document.getElementById("tabela_matriz_2");	//Pega o elemento do HTML que representa a matriz 2
	var t3 = document.getElementById("tabela_matriz_3");	//Pega o elemento do HTML que representa a matriz resultado
	if(m1.width != 0 && m1.height != 0 && m1.width == m2.width && m1.height == m2.height)
	{
		//Preenche todos os espaços vazios com 0
		replaceNulls('1');
		replaceNulls('2');
		
		//Altera o tamanho da matriz de id 3 (resultado) para o mesmo da matriz 1
		changeTableSize('3',m1);
		
		//soma
		for(var i=0; i<m1.width; i++)	//i=0; i<linhas; i++
		{
			for(var j=0; j<m1.height; j++)	//j=0; j<colunas; j++
			{
				//Formatação dos IDs: t_IDdaMatriz_linha_coluna. Exemplo: t_1_1_2 (matriz 1, linha 1, coluna 2)
				var _td1 = document.getElementById("t_1_" + i + "_" + j);
				var _td2 = document.getElementById("t_2_" + i + "_" + j);
				var _td3 = document.getElementById("t_3_" + i + "_" + j);
				//Você pode acessar o valor e definir através da propriedade value. Atenção: o tipo é string, logo precisa usar parseInt para converter pra int
				//antes de realizar operações
				_td3.value = parseInt(_td1.value) + parseInt(_td2.value);
			}
		}
		//Desenha todas as matrizes (quando possível).
		DrawAllMatrix();
	}
	else
		err("O tamanho das matrizes precisa ser o mesmo para somar");
}

function sub()
{
	var t1 = document.getElementById("tabela_matriz_1");	//Pega o elemento do HTML que representa a matriz 1
	var t2 = document.getElementById("tabela_matriz_2");	//Pega o elemento do HTML que representa a matriz 2
	var t3 = document.getElementById("tabela_matriz_3");	//Pega o elemento do HTML que representa a matriz resultado
	if(m1.width != 0 && m1.height != 0 && m1.width == m2.width && m1.height == m2.height)
	{
		//Preenche todos os espaços vazios com 0
		replaceNulls('1');
		replaceNulls('2');
		
		//Altera o tamanho da matriz de id 3 (resultado) para o mesmo da matriz 1
		changeTableSize('3',m1);
		
		//subtração
		for(var i=0; i<m1.width; i++)	//i=0; i<linhas; i++
		{
			for(var j=0; j<m1.height; j++)	//j=0; j<colunas; j++
			{
				//Formatação dos IDs: t_IDdaMatriz_linha_coluna. Exemplo: t_1_1_2 (matriz 1, linha 1, coluna 2)
				var _td1 = document.getElementById("t_1_" + i + "_" + j);
				var _td2 = document.getElementById("t_2_" + i + "_" + j);
				var _td3 = document.getElementById("t_3_" + i + "_" + j);
				//Você pode acessar o valor e definir através da propriedade value. Atenção: o tipo é string, logo precisa usar parseInt para converter pra int
				//antes de realizar operações
				_td3.value = parseInt(_td1.value) - parseInt(_td2.value);
			}
		}
		//Desenha todas as matrizes (quando possível).
		DrawAllMatrix();
	}
	else
		err("O tamanho das matrizes precisa ser o mesmo para somar");
}

function mult()
{
	var t1 = document.getElementById("tabela_matriz_1");	//Pega o elemento do HTML que representa a matriz 1
	var t2 = document.getElementById("tabela_matriz_2");	//Pega o elemento do HTML que representa a matriz 2
	var t3 = document.getElementById("tabela_matriz_3");	//Pega o elemento do HTML que representa a matriz resultado
	if(m1.width != 0 && m1.height != 0 && m1.height == m2.width)
	{
		//Preenche todos os espaços vazios com 0
		replaceNulls('1');
		replaceNulls('2');
		//Alterar o tamanho da matriz resultado (3)
		changeTableSize('3',new matrix_size(m1.width,m2.height));
		//Fazer a lógica de multiplicação
		for(var i=0; i<m1.width; i++)	//i=0; i<linhas; i++
		{
			for(var z=0; z<m2.height; z++)	//z=0; i<linhas; z++
			{
				var sum = 0;
				for(var j=0; j<m1.height; j++)	//j=0; j<colunas; j++
				{
					var a = document.getElementById("t_1_" + i + "_" + j);
					var b = document.getElementById("t_2_" + j + "_" + z);
					sum += parseFloat(a.value) * parseFloat(b.value);
				}
				document.getElementById("t_3_" + i + "_" + z).value = sum;
			}
		}
		
		//Desenha todas as matrizes (quando possível).
		DrawAllMatrix();
	}
	else
		err("O numero de colunas da primeira precisa ser igual ao de linhas da segunda");
}

function multE()
{
	var t1 = document.getElementById("tabela_matriz_1");	//Pega o elemento do HTML que representa a matriz 1
	var t2 = document.getElementById("tabela_matriz_2");	//Pega o elemento do HTML que representa a matriz 2
	var t3 = document.getElementById("tabela_matriz_3");	//Pega o elemento do HTML que representa a matriz resultado
	if(m1.width != 0 && m1.height != 0 && m1.height == 1 && m1.width == 1)
	{
		//Preenche todos os espaços vazios com 0
		replaceNulls('1');
		replaceNulls('2');
		//Alterar o tamanho da matriz resultado (3)
		changeTableSize('3',m2);
		//Fazer a lógica de multiplicação
		var a = document.getElementById("t_1_" + 0 + "_" + 0);
		for(var i=0; i<m2.width; i++)	//i=0; i<linhas; i++
		{
			for(var j=0; j<m2.height; j++)	//z=0; i<linhas; z++
			{
				var b = document.getElementById("t_2_" + i + "_" + j);
				document.getElementById("t_3_" + i + "_" + j).value = a.value * b.value;
			}
		}
		//Desenha todas as matrizes (quando possível).
		DrawAllMatrix();
	}
	else
		err("O numero de colunas da primeira precisa ser igual ao de linhas da segunda");
}

function transp()
{
	var t1 = document.getElementById("tabela_matriz_1");	//Pega o elemento do HTML que representa a matriz 1
	var t2 = document.getElementById("tabela_matriz_2");	//Pega o elemento do HTML que representa a matriz 2
	var t3 = document.getElementById("tabela_matriz_3");	//Pega o elemento do HTML que representa a matriz resultado
	var id = parseInt(document.getElementById("transposta_id").value);
	if(id == 1 || id == 2)
	{
		if((id == 1 && m1.width != 0 && m1.height != 0)||(id == 2 && m2.width != 0 && m2.height != 0))
		{
			//Preenche todos os espaços vazios com 0
			replaceNulls('1');
			replaceNulls('2');
			//Alterar o tamanho da matriz resultado (3)
			var m = id == 1 ? m1 : m2;
			changeTableSize('3', new matrix_size(m.height,m.width));
			for(var i=0; i<(id == 1 ? m1 : m2).width; i++)	//i=0; i<linhas; i++
			{
				for(var j=0; j<(id == 1 ? m1 : m2).height; j++)	//z=0; i<linhas; z++
				{
					var b = document.getElementById("t_" + id + "_" + i + "_" + j);
					document.getElementById("t_3_" + j + "_" + i).value = b.value;
				}
			}
			//Desenha todas as matrizes (quando possível).
			DrawAllMatrix();
		}
		else
			err("O tamanho da matriz nao pode ser 0");
	}
}

function det()
{
	var t1 = document.getElementById("tabela_matriz_1");	//Pega o elemento do HTML que representa a matriz 1
	var t2 = document.getElementById("tabela_matriz_2");	//Pega o elemento do HTML que representa a matriz 2
	var t3 = document.getElementById("tabela_matriz_3");	//Pega o elemento do HTML que representa a matriz resultado
	var id = parseInt(document.getElementById("det_id").value);
	if(id == 1 || id == 2)
	{
		var m = id == 1 ? m1 : m2;
		if(m.width != 0 && m.height != 0)
		{
			if(m.width == m.height)
			{
				//Preenche todos os espaços vazios com 0
				replaceNulls('1');
				replaceNulls('2');
				//Alterar o tamanho da matriz resultado (3)
				changeTableSize('3', new matrix_size(1,1));
				
				switch(m.width)
				{
					case 1:
						var b = document.getElementById("t_" + id + "_" + 0 + "_" + 0);
						document.getElementById("t_3_" + 0 + "_" + 0).value = b.value;
						break;
					case 2:
						var a = document.getElementById("t_" + id + "_" + 0 + "_" + 0);
						var b = document.getElementById("t_" + id + "_" + 1 + "_" + 1);
						var c = document.getElementById("t_" + id + "_" + 0 + "_" + 1);
						var d = document.getElementById("t_" + id + "_" + 1 + "_" + 0);
						document.getElementById("t_3_" + 0 + "_" + 0).value = parseInt(a.value) * parseInt(b.value) - parseInt(c.value) * parseInt(d.value);
						break;
					case 3:
						var a11 = parseInt(document.getElementById("t_" + id + "_" + 0 + "_" + 0).value);
						var a12 = parseInt(document.getElementById("t_" + id + "_" + 0 + "_" + 1).value);
						var a13 = parseInt(document.getElementById("t_" + id + "_" + 0 + "_" + 2).value);
						var a21 = parseInt(document.getElementById("t_" + id + "_" + 1 + "_" + 0).value);
						var a22 = parseInt(document.getElementById("t_" + id + "_" + 1 + "_" + 1).value);
						var a23 = parseInt(document.getElementById("t_" + id + "_" + 1 + "_" + 2).value);
						var a31 = parseInt(document.getElementById("t_" + id + "_" + 2 + "_" + 0).value);
						var a32 = parseInt(document.getElementById("t_" + id + "_" + 2 + "_" + 1).value);
						var a33 = parseInt(document.getElementById("t_" + id + "_" + 2 + "_" + 2).value);
						document.getElementById("t_3_" + 0 + "_" + 0).value = (a11 * a22 * a33 + a12 * a23 * a31 + a13 * a21 * a32) - (a13 * a22 * a31 + a11 * a23 * a32 + a12 * a21 * a33);
						break;
					default:					
						var A = [];     //generates the array
						for (var i = 0; i < m.width; i++)
						{
							A[i] = [];
							for (var j = 0; j < m.height; j++)
							{                       
								A[i][j] =  i + ':' + j;             
							}
						}           

						for (var i = 0; i < m.width; i++)
						{  
							//reads the array
							for (var j=0; j<m.height; j++)
							{
								var _id = "t_" + id + "_" + i + "_" + j;
								//console.log(_id);
								A[i][j] = parseFloat(document.getElementById(_id).value);                                        
							}
						}

						document.getElementById("t_3_" + 0 + "_" + 0).value = _det(A);
						break;
				}
				DrawAllMatrix();
			}
			else
				err("A matriz precisa ser quadrada");
		}
		else
			err("O tamanho da matriz nao pode ser 0");
	}
}

function _det(M) {
	if (M.length == 1) { return (M[0][0]); }
	if (M.length==2) { return (M[0][0]*M[1][1])-(M[0][1]*M[1][0]); }
	var answer = 0;
	for (var i=0; i<M.length; i++) { answer += Math.pow(-1,i)*M[0][i]*_det(deleteRowAndColumn(M,i)); }
	return answer;
}

function deleteRowAndColumn(M,index) {
   var temp = [];
   // copy the array first
   for (var i=0; i<M.length; i++) { temp.push(M[i].slice(0)); } 
   // delete the first row
   temp.splice(0,1); 
   // delete the column at the index specified
   for (var i=0; i<temp.length; i++) { temp[i].splice(index,1); } 
   return temp;
}

function inversa()
{
	var t1 = document.getElementById("tabela_matriz_1");	//Pega o elemento do HTML que representa a matriz 1
	var t2 = document.getElementById("tabela_matriz_2");	//Pega o elemento do HTML que representa a matriz 2
	var t3 = document.getElementById("tabela_matriz_3");	//Pega o elemento do HTML que representa a matriz resultado
	var id = parseInt(document.getElementById("inversa_id").value);
	if(id == 1 || id == 2)
	{
		var m = id == 1 ? m1 : m2;
		if(m.width != 0 && m.height != 0 && m.width == m.height)
		{
			//Preenche todos os espaços vazios com 0
			replaceNulls('1');
			replaceNulls('2');
			switch(m.width)
			{
				case 1:
					err("Essa matriz nao possui inversa");
					break;
				case -2:
					var old_det_id = document.getElementById("det_id").value;
					document.getElementById("det_id").value = id;
					det();
					document.getElementById("det_id").value = old_det_id;
					var __det = document.getElementById("t_3_" + 0 + "_" + 0).value;
					
					if(__det == 0)
						err("Essa matriz nao possui inversa");
					else
					{
						changeTableSize('3', new matrix_size(2,2));
						var w = parseInt(document.getElementById("t_" + id + "_" + 0 + "_" + 0).value);
						var x = parseInt(document.getElementById("t_" + id + "_" + 0 + "_" + 1).value);
						var y = parseInt(document.getElementById("t_" + id + "_" + 1 + "_" + 0).value);
						var z = parseInt(document.getElementById("t_" + id + "_" + 1 + "_" + 1).value);
						var a = (-z/x)/((-z*w)/x + y);
						var b = 1/((w*-z)/x + y);
						var c = (-y * a) / z;
						var d = (-w * b)/x;
						document.getElementById("t_3_" + 0 + "_" + 0).value = a;
						document.getElementById("t_3_" + 0 + "_" + 1).value = b;
						document.getElementById("t_3_" + 1 + "_" + 0).value = c;
						document.getElementById("t_3_" + 1 + "_" + 1).value = d;
					}
					break;
				default:
					var old_det_id = document.getElementById("det_id").value;
					document.getElementById("det_id").value = id;
					det();
					document.getElementById("det_id").value = old_det_id;
					var __det = document.getElementById("t_3_" + 0 + "_" + 0).value;
					
					if(__det == 0)
						err("Essa matriz nao possui inversa");
					else
					{
						var C = [];     //generates the array
						for (var i = 0; i < m.width; i++)
						{
							C[i] = [];
							for (var j = 0; j < m.height; j++)
							{                       
								C[i][j] =  i + ':' + j;             
							}
						}
						var R = [];     //generates the array
						for (var i = 0; i < m.width; i++)
						{
							R[i] = [];
							for (var j = 0; j < m.height; j++)
							{                       
								R[i][j] =  i + ':' + j;             
							}
						}
						var A = [];     //generates the array
						for (var i = 0; i < m.width; i++)
						{
							A[i] = [];
							for (var j = 0; j < m.height; j++)
							{                       
								A[i][j] =  i + ':' + j;             
							}
						}           

						for (var i = 0; i < m.width; i++)
						{  
							//reads the array
							for (var j=0; j<m.height; j++)
							{
								var _id = "t_" + id + "_" + i + "_" + j;
								//console.log(_id);
								A[i][j] = parseFloat(document.getElementById(_id).value);                                        
							}
						}
						
						for (var i = 0; i < m.width; i++)
						{
							for (var j = 0; j < m.height; j++)
							{
								C[j][i] = cofator(i,j,A);
							}
						}
						
						var fact = 1 / _det(A);
						
						for(var i=0; i<A.length; i++)
						{
							for(var j=0; j<A[i].length; j++)
							{
								R[i][j] = fact * C[i][j];
							}
						}
						
						changeTableSize('3', new matrix_size(R.length,R.length));
						
						for(var i=0; i<R.length; i++)
						{
							for(var j=0; j<R[i].length; j++)
							{
								var _id = "t_3_" + i + "_" + j;
								document.getElementById(_id).value = R[i][j];
							}
						}
					}
					break;
			}
			DrawAllMatrix();
		}
		else
			err("O tamanho da matriz nao pode ser 0");
	}
}

function menorPrincipal(_i,_j,M)
{
	var A = [];
	for (var i = 0; i < M.length - 1; i++)
	{
		A[i] = [];
		for (var j = 0; j < M[i].length - 1; j++)
		{                       
			A[i][j] =  i + ':' + j;             
		}
	}      
	for (var i = 0; i < M.length; i++)
	{
		if(i != _i)
		{
			for (var j = 0; j < M[i].length; j++)
			{
				if(j != _j)
				{
					A[i > _i ? i - 1 : i][j > _j ? j - 1 : j] = M[i][j];
				}
			}
		}
	}
	return _det(A);
}

function cofator(i,j, M)
{
	var r = Math.pow(-1,i+j) * menorPrincipal(i,j,M);
	return r == -0 ? 0 : r;
}

function err(str)
{
	//error
	console.log(str);
	document.getElementById("err").innerText = str;
}

//Substitui todos os campos vazios por 0
function replaceNulls(id)
{
	var t_size = parseInt(id) == 1 ? m1 : m2;
	for(var i=0; i<t_size.width; i++)
	{
		for(var j=0; j<t_size.height; j++)
		{
			try
			{
				var _input = document.getElementById("t_" + id + "_" + i + "_" + j);
				if(_input.value == "")
					_input.value = "0";
			}
			catch(err){}
		}
	}
}

//Função usada pelo botão de alterar o tamanho
function alterTable(id)
{
	var i_m = parseInt(document.getElementById("linha_amount_" + id).value);
	var j_m = parseInt(document.getElementById("coluna_amount_" + id).value);
	if(j_m > 0 && i_m > 0)
	{
		switch(parseInt(id))
		{
			case 1:
				m1 = new matrix_size(i_m,j_m);
				break;
			case 2:
				m2 = new matrix_size(i_m,j_m);
				break;
		}			
		changeTableSize(id, new matrix_size(i_m, j_m));
	}
}

function gerarLeiDeFormacao()
{
	var id = document.getElementById("lei_de_formacao_id").value;
	var w = document.getElementById("lei_de_formacao_width").value;
	var h = document.getElementById("lei_de_formacao_height").value;
	var code = document.getElementById("lei_de_formacao_code").value;
	
	var checkSize = new RegExp("[0-9]");
	var checkCode = new RegExp("^[0-9|i|j|\\s|/+|/*|\/|\-]*$");
	
	if(checkSize.test(w) && checkSize.test(h))
	{
		w=parseInt(w);
		h=parseInt(h);
		if(checkCode.test(code))
		{
			if(id == "1")
				m1 = new matrix_size(w,h);
			else
				m2 = new matrix_size(w,h);
			changeTableSize(id,new matrix_size(w,h));
			for(var i=0; i<w; i++)
			{
				for(var j=0; j<h; j++)
				{
					var result_total = 0;
					if(IndexOfAny(code, ["+","-","*","/"] == -1))
						code += " + 0";
					if(code.indexOf("+") != -1)
					{
						var _s = code.split("+");
						result_total = 0;
						for(var s=0; s<_s.length; s++)
						{
							_s[s] = (_s[s]+"").trim();
							var x = _s[s].indexOf("i");
							if(x != -1)
								result_total += _s[s].length == 1 ? i+1 : parseInt(_s[s].substring(0,x)) * (i+1);
							x = _s[s].indexOf("j");
							if(x != -1)
								result_total += _s[s].length == 1 ? j+1 : parseInt(_s[s].substring(0,x)) * (j+1);
							if(_s[s].indexOf("j") == -1 && _s[s].indexOf("i") == -1)
								result_total += parseInt(_s[s]);
						}
					}
					else if(code.indexOf("-") != -1)
					{
						var _s = code.split("-");
						result_total = 0;
						for(var s=0; s<_s.length; s++)
						{
							_s[s] = (_s[s]+"").trim();
							var x = _s[s].indexOf("i");
							if(x != -1)
								result_total -= _s[s].length == 1 ? i+1 : parseInt(_s[s].substring(0,x)) * (i+1);
							x = _s[s].indexOf("j");
							if(x != -1)
								result_total -= _s[s].length == 1 ? j+1 : parseInt(_s[s].substring(0,x)) * (j+1);
							if(_s[s].indexOf("j") == -1 && _s[s].indexOf("i") == -1)
								result_total -= parseInt(_s[s]);
						}
					}
					else if(code.indexOf("*") != -1)
					{
						var _s = code.split("*");
						result_total = 1;
						for(var s=0; s<_s.length; s++)
						{
							_s[s] = (_s[s]+"").trim();
							var x = _s[s].indexOf("i");
							if(x != -1)
								result_total *= _s[s].length == 1 ? i+1 : parseInt(_s[s].substring(0,x)) * (i+1);
							x = _s[s].indexOf("j");
							if(x != -1)
								result_total *= _s[s].length == 1 ? j+1 : parseInt(_s[s].substring(0,x)) * (j+1);
							if(_s[s].indexOf("j") == -1 && _s[s].indexOf("i") == -1)
								result_total *= parseInt(_s[s]);
						}
					}
					else if(code.indexOf("/") != -1)
					{
						var _s = code.split("/");
						result_total = 0;
						for(var s=0; s<_s.length; s++)
						{
							_s[s] = (_s[s]+"").trim();
							var x = _s[s].indexOf("i");
							var rr = 0;
							if(x != -1)
								rr = _s[s].length == 1 ? i+1 : parseInt(_s[s].substring(0,x)) * (i+1);
							x = _s[s].indexOf("j");
							if(x != -1)
								rr = _s[s].length == 1 ? j+1 : parseInt(_s[s].substring(0,x)) * (j+1);
							if(_s[s].indexOf("j") == -1 && _s[s].indexOf("i") == -1)
								rr = parseInt(_s[s]);
							if(rr != 0 && result_total == 0)
								result_total = rr;
							else
								result_total/=rr;
						}
					}
					else
					{
						code = code.trim();
						result_total = parseInt(code);
					}
					
					var _input = document.getElementById("t_" + id + "_" + i + "_" + j);
					_input.value = result_total;
					if(_input.value == "NaN")
						err("Não foi possível gerar a matriz. Por favor verifique a sintaxe da lei de formação");
					else
						err("");
				}
			}
		}
		else
			err("A lei de formação não é válida");
	}
	else
		err("Digite valores válidos para largura e altura");
	UpdateDrawInfo();
}

//Função para alterar o tamanho de uma tabela (<id da tabela>, <tamanho>). ID da tabela (1,2,3 -> matriz 1, matriz 2, matriz resultado).
//Tamanho é um objeto do tipo matrix_size (new matrix_size(x,y)).
function changeTableSize(id,size)
{
	var i_m = size.width;
	var j_m = size.height;
	if(id + "" == "3")
		m3 = size;
	var count = 0;
	if(j_m > 0 && i_m > 0)
	{
		var t = document.getElementById("tabela_matriz_" + id);
		t.style.display = "block";
		t.parentElement.parentElement.parentElement.style.display = "";
		t.innerHTML = "";
		var t_t = "";
		for(var i = 0; i< i_m; i++)
		{
			t_t += "<tr>";
			for(var j = 0; j< j_m; j++)
			{
				t_t += "<td> <input onkeyup = 'UpdateDrawInfo()' id='t_" + id + "_" + i + "_" + j + "' style = 'width:30;height:28;text-align:center;'> </td>";
				count ++;
			}
			t_t += "</tr>";
		}
		t.innerHTML = t_t;
	}
}

function UpdateDrawInfo()
{
	UpdateInfo("1");
	UpdateInfo("2");
	UpdateInfo("3");
	function UpdateInfo(id)
	{
		var m = id == "1" ? m1 : (id == "2" ? m2 : m3);
		var A = [];     //generates the array
		for (var i = 0; i < m.width; i++)
		{
			A[i] = [];
			for (var j = 0; j < m.height; j++)
			{                       
				A[i][j] =  i + ':' + j;             
			}
		}           

		for (var i = 0; i < m.width; i++)
		{  
			//reads the array
			for (var j=0; j<m.height; j++)
			{
				var _id = "t_" + id + "_" + i + "_" + j;
				A[i][j] = parseFloat(document.getElementById(_id).value);                                        
			}
		}
		
		var empty = m.width <= 0 && m.height <= 0 || !CheckInput(id);
		document.getElementById("m" + id + "_info").innerText = "Tem inversa: " + (empty ? "?" : (_det(A) == 0 ? "NÃO" : "SIM")) + " | É simétrica: " + (empty ? "?" : (IsEqual(A) ? "SIM" : "NÃO"));
		
		DrawAllMatrix(1);
	}
	function IsEqual(M)
	{
		for (var i = 0; i < M.length; i++)
		{  
			for (var j=0; j< M[i].length; j++)
			{
				try
				{
					if(M[j][i] != M[i][j])
						return false;
				}
				catch(err)
				{
					return false;
				}
			}
		}
		return true;
	}
}

function CheckInput(id)
{
	var m = id == "1" ? m1 : (id == "2" ? m2 : m3);
	var A = [];     //generates the array
	for (var i = 0; i < m.width; i++)
	{
		A[i] = [];
		for (var j = 0; j < m.height; j++)
		{                       
			A[i][j] =  i + ':' + j;             
		}
	}           

	for (var i = 0; i < m.width; i++)
	{  
		//reads the array
		for (var j=0; j<m.height; j++)
		{
			var _id = "t_" + id + "_" + i + "_" + j;
			var x = document.getElementById(_id).value;
			if(x.trim() == "")
				return false;
			try
			{
				ver = new RegExp("[^0-9|.|,]");
				if(parseFloat(x) + '' == "NaN" || ver.test(x))
					return false;
			}
			catch(err){return false;}
		}
	}
	return true;
}

function IndexOfAny(str, arr)
{
	for(var i=0; i<arr.length; i++)
	{
		var a = str.indexOf(arr[i]);
		if(a != -1)
			return a;
	}
	return -1;
}

//Desenha todas as matrizes
function DrawAllMatrix(update)
{
	if(update != 1)
		err("");
	ctx.clearRect(0,0,canvas.width,canvas.height);
	ctx.fillStyle="#333";
	ctx.fillRect(0,0,canvas.width,canvas.height);
	
	ctx.beginPath();
	ctx.moveTo(canvas.width/2,0);
	ctx.lineTo(canvas.width/2, canvas.height);
	ctx.strokeStyle = "#FFF";
	ctx.stroke();
	
	ctx.beginPath();
	ctx.moveTo(0, canvas.height/2);
	ctx.lineTo(canvas.width, canvas.height/2);
	ctx.strokeStyle = "#FFF";
	ctx.stroke();
	
	DrawMatrix("1", "#F00", update);
	DrawMatrix("2", "#00F", update);
	DrawMatrix("3", "#0F0", update);
}

//Desenha uma matriz. (<ID da matriz>,<cor>)
function DrawMatrix(id, color, update)
{
	if(update != 1)
		replaceNulls(""+id);
	try
	{
		switch(id+"")
		{
			case "1":
				_matrix = m1;
				break;
			case "2":
				_matrix = m2;
				break;
			case "3":
				_matrix = m3;
				break;
		}
		if(_matrix.width == 2)
		{
			var _j = _matrix.height-1;
			var lastPoint = new Point(parseInt(document.getElementById("t_" + id + "_" + 0 + "_" + _j).value),parseInt(document.getElementById("t_" + id + "_" + 1 + "_" + _j).value));
			for(var j=0; j<_matrix.height; j++)
			{
				var x = parseInt(document.getElementById("t_" + id + "_" + 0 + "_" + j).value);
				var y = parseInt(document.getElementById("t_" + id + "_" + 1 + "_" + j).value);
				DrawLine(lastPoint, new Point(x,y), color);
				lastPoint = new Point(x,y);
			}
		}
	}
	catch(err){}
}

function DrawLine(point1, point2, color)
{
	var scale_factor = 10;
	point1.y *= -1;
	point2.y *= -1;
	ctx.beginPath();
	ctx.moveTo(point1.x * scale_factor + canvas.width/2,point1.y * scale_factor + canvas.height/2);
	ctx.lineTo(point2.x * scale_factor + canvas.width/2, point2.y * scale_factor + canvas.height/2);
	ctx.strokeStyle = color;
	ctx.stroke();
}
</script>